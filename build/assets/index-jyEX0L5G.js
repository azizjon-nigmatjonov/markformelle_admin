import{i as h,u as S,r as f,c as x,l as E,d as v,f as C,e as j,g as N,o as y,j as e,n as P,P as g,a as L,q as k,E as q,D as F,s as T,C as I,t as M,H as $,h as D,A as _}from"./index-DRACHr32.js";import{r as b,L as O}from"./ListSkeleton-BnN02IPO.js";import{P as Q}from"./PopOver-X96IiLWI.js";const w={deleteElement:s=>h.delete(`/permissions/${s}`),getList:()=>h.get("/permissions"),createElement:s=>h.post("/permissions",s)},z=[{label:"Sahifani ko'rsatish",value:"index"},{label:"Ichki sahifani ko'rsatish",value:"view"},{label:"Qo'shish",value:"add"},{label:"Tahrirlash",value:"edit"},{label:"O'chirish",value:"delete"}],R=({handleClose:s,reset:t})=>{const{mutate:n,isLoading:a}=x({mutationFn:r=>b.createElement(r).then(()=>{s(),t()})}),{mutate:i,isLoading:l}=x({mutationFn:r=>w.createElement(r).then(()=>{s(),t()})});return{createRoute:r=>{const o={};o.path=r.name,o.name=r.title,n(o)},isLoading:a||l,createPermission:(r,o,c)=>{const u={};u.name=c+"#"+r,u.permission_route_id=o,i(u)}}},A=({handleClose:s})=>{const{mutate:t,isLoading:n}=x({mutationFn:m=>w.deleteElement(m).then(()=>{s()})}),{mutate:a,isLoading:i}=x({mutationFn:m=>b.deleteElement(m).then(()=>{s()})});return{deletePermission:m=>{t(m)},deleteRoute:m=>{a(m)},isLoading:n||i}},B=s=>{const t=[];for(const n in s)s[n].forEach(a=>{a.single_page||t.push(a)});return t},G=()=>{const{data:s,isLoading:t,refetch:n}=S(["GET_ROUTE_LIST"],()=>b.getList()),a=f.useMemo(()=>{var l;return((l=s==null?void 0:s.data)==null?void 0:l.map(d=>{var r;const m=(r=d.permissions)==null?void 0:r.map(o=>({...o,label:o.name.substring(o.name.indexOf("#")+1),value:o.id}));return{...d,permissions:m??[]}}))??[]},[s]);return{isLoading:t,refetch:n,newRouteList:a}},H=({list:s,path:t})=>{const n=E(i=>i.website.new_routes);return{permissionOptions:f.useMemo(()=>{var r,o;const i=[];return[...((o=(r=B(n).find(c=>c.path===t))==null?void 0:r.permissions)==null?void 0:o.map(c=>({label:c,value:c})))??[],...z].forEach(c=>{s.find(p=>p.label===c.value)||i.push(c)}),i},[s])??[]}},U=()=>v().shape({permissions:C().of(j()).required("Majbiriy maydon").test("is-permissions-empty","Permission kiritilmagan",s=>s&&s.length>0)}),V=({id:s,path:t="",list:n=[],handleClose:a})=>{const{permissionOptions:i}=H({list:n,path:t}),l=U(),{handleSubmit:d,reset:m}=N({mode:"onSubmit",resolver:y(l)}),{createPermission:r,isLoading:o}=R({handleClose:a,reset:m});if(o)return e.jsx("div",{children:e.jsxs("button",{className:"custom-btn",children:[e.jsx(P,{size:24}),e.jsx(g,{})]})});const c=u=>{u.permissions.forEach(p=>{r(p,s,t)})};return i!=null&&i.length?e.jsx("form",{onSubmit:d(c),className:"flex space-x-5",children:e.jsx("div",{className:"w-[70px]",children:e.jsx("button",{type:"submit",className:"custom-btn",children:e.jsx(g,{})})})}):""},J=({route:s,handleClose:t=()=>{},deleteRoute:n=()=>{},deletePermission:a=()=>{}})=>{var o;const{navigateTo:i}=L(),[l,d]=f.useState(!1),{t:m}=k(),r=(c,u)=>{c==="delete"&&n(u),d(!1)};return e.jsxs("div",{className:"flex space-x-10 py-20px border-t border-[var(--gray20)]",children:[e.jsxs("div",{className:"w-[360px] relative",children:[e.jsxs("div",{className:"w-[360px] flex items-center justify-between",children:[e.jsx("p",{className:"",children:s.name}),e.jsxs("div",{className:"flex items-center space-x-5",children:[e.jsx("button",{onClick:()=>i(`/${s.path}?fromRoutes=/admins/routes`),children:e.jsx(q,{fill:"var(--primary)"})}),e.jsx("button",{onClick:()=>d(!0),children:e.jsx(F,{})})]})]}),l&&e.jsx(Q,{title:`${s.name}`,text:"Routeni ochirmoqchimsiz!",classes:"top-[30px] left-auto right-0",closePopover:c=>{r(c,s.id)}})]}),e.jsx("div",{className:"w-[1px] h-[30px] bg-[var(--gray30)] common-shadow"}),e.jsx("div",{className:"w-full",children:e.jsxs("div",{className:"flex gap-5 flex-wrap",children:[(o=s.permissions)==null?void 0:o.map(c=>e.jsxs("div",{className:"border border-[var(--gray20)] h-[40px] px-16px whitespace-nopwrap rounded-[8px] common-shadow min-w-[120px] flex items-center justify-between space-x-5",children:[e.jsx("span",{children:m(c.label)}),e.jsx("button",{onClick:()=>a(c.id),className:"border border-[var(--gray30)] rounded-full w-[20px] h-[20px] flex items-center justify-center cursor-pointer",children:e.jsx(T,{})})]})),e.jsx(V,{list:s.permissions,handleClose:t,id:s.id,route:s,path:s.path})]})})]})},Y=({newRouteList:s,isLoading:t=!0,handleClose:n})=>{if(t)return e.jsx("div",{className:"mt-10",children:e.jsx(O,{direction:"row",count:7,height:102})});if(!(s!=null&&s.length))return e.jsx("div",{className:"w-full flex justify-center mt-10",children:e.jsx("img",{className:"w-[200px]",src:"/images/no-data.png",alt:"no data"})});const{deletePermission:a,deleteRoute:i}=A({handleClose:n});return e.jsx("div",{className:"mt-10",children:s.map((l,d)=>e.jsx(J,{handleClose:n,deleteRoute:i,deletePermission:a,route:l},d))})},K=()=>v().shape({name:j().required("Majbiriy maydon"),title:j().required("Majbiriy maydon")}),W=({handleClose:s=()=>{}})=>{const t=K(),{handleSubmit:n,reset:a}=N({mode:"onSubmit",resolver:y(t)}),{createRoute:i,isLoading:l}=R({handleClose:s,reset:a}),d=m=>i(m);return e.jsx(I,{title:"Yangi route qo'shish",open:!0,handleClose:()=>s(),footerActive:!1,children:e.jsx("form",{onSubmit:n(d),children:e.jsx("div",{className:"mt-5",children:l?e.jsxs("div",{className:"custom-btn disabled form",children:[e.jsx(P,{size:30}),"Jo'natilmoqda"]}):e.jsx("button",{type:"submit",className:"custom-btn form",children:"Tasdiqlash"})})})})},X=[{label:"Routes",link:"/admins/routes"},{label:"Страница ROUTES"}],te=()=>{const{navigateQuery:s}=L(),{modal:t}=M(),{newRouteList:n,refetch:a,isLoading:i}=G(),l=()=>{s({modal:"",active:""}),a()};return e.jsxs(e.Fragment,{children:[e.jsx($,{extra:e.jsx(D,{items:X,progmatic:!0}),children:e.jsx("div",{className:"ml-5",children:e.jsx(_,{onClick:()=>s({modal:"open"}),iconLeft:!0,text:"Route qo'shish"})})}),e.jsxs("div",{className:"container",children:[e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-[#101828] text-lg font-semibold",children:"Добавить новую страницу и разрешение"}),e.jsx("p",{className:"text-[#475467] text-sm font-normal",children:"Добавьте новую страницу и разрешение на управление разрешениями. место"})]})}),e.jsx(Y,{isLoading:i,handleClose:l,newRouteList:n})]}),t&&e.jsx(W,{handleClose:l,newRouteList:n})]})};export{X as breadCrumbs,te as default};

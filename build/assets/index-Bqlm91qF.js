import{r as h,u as j,a as p,b as g,c as S,d as v,w as _,e as M,f as c,g as q,h as C,o as L,j as d}from"./index-CTFI2LGG.js";import{g as $,F as T,C as k}from"./index-evpdQIgV.js";import{A as w}from"./AddButton-BzXG_pbh.js";import{C as Q}from"./index-B9pHVk68.js";import{r as R}from"./index-DYxRhrm6.js";import{H as E,C as N}from"./index-BbpQxzbw.js";import"./colorManipulator-DaxCPPGs.js";import"./PopOver-CxqJjWXh.js";import"./useModal-CEVRpokf.js";import"./index-CpUa0xWb.js";const b={getList:e=>h.get(`/admins?q=${e==null?void 0:e.q}&page=${e.page}`),createAdmin:e=>h.post("/admins",e),updateAdmin:(e,t)=>h.put(`/admins/${t}`,e),deleteAdmin:e=>h.delete(`/admins/${e}`),getAdmin:e=>h.get(`/admins/${e}`)},V=({adminId:e})=>{const{data:t}=j(["GET_ROLLS_LIST"],()=>R.getList()),{data:n}=j(["GET_ROLL_DATA",e],()=>b.getAdmin(e),{enabled:!!(e&&e!=="create")}),r=p.useMemo(()=>t?((t==null?void 0:t.data)??[]).map(s=>({...s,label:s.name,value:s.id})):[],[t]),a=p.useMemo(()=>{var s;const i=n==null?void 0:n.data;return i!=null&&i.id&&(i.roles=(s=i.roles)==null?void 0:s.map(u=>u.id)),i},[n]);return{rolls:r,defaultValues:a}},D=({refetch:e,reset:t})=>{const{navigateQuery:n}=g(),r=S(),a=o=>{r(_.setAlertData({title:o,translation:"common"})),n({id:""}),e(),t()},{mutate:i,isLoading:s}=v({mutationFn:o=>b.createAdmin(o).then(()=>{a("Admin yaratildi!")})}),{mutate:u,isLoading:l}=v({mutationFn:o=>b.updateAdmin(o,o.id).then(()=>{a("Ma'lumot yangilandi!")})});return{submitForm:o=>{o.phone=o.phone.substring(1).replace(/\s+/g,""),i(o)},updateForm:(o,f)=>{o.phone=o.phone.substring(1).replace(/\s+/g,"");const y=o;y.id=f,u(y)},isLoading:l||s}},G=()=>M().shape({name:c().required("Majbiriy maydon"),email:c().required("Majburiy maydon").email("enter_valid_email"),roles:q().of(c()).required("Majburiy maydon").test("is-roles-empty","Majburiy maydon",e=>e&&e.length>0),phone:c().matches(/^(\+998)\s(9[0-9])\s([0-9]{3})\s([0-9]{2})\s([0-9]{2})$/,"enter_valid_phone_number").required("enter_phone_number"),password:c().required("Majbiriy maydon")}),H=()=>M().shape({name:c().required("Majburiy maydon"),email:c().required("Majburiy maydon").email("Tog'ri email kiriting!"),phone:c().required("enter_phone_number"),roles:q().of(c()).required("Majburiy maydon").test("is-roles-empty","Majburiy maydon",e=>e&&e.length>0)}),O=({refetch:e,id:t})=>{const n=t==="create"?G():H(),{handleSubmit:r,reset:a}=C({mode:"onSubmit",resolver:L(n)}),{submitForm:i,updateForm:s}=D({reset:a,refetch:e}),u=l=>{t==="create"?i(l):s(l,t)};return d.jsx("form",{onSubmit:r(u)})},z=({refetch:e,id:t})=>{const{navigateQuery:n}=g(),{rolls:r,defaultValues:a}=V({adminId:t});return d.jsx(Q,{title:t?"Ma'lumotni tahrirlash":"add_new_admin",open:!0,handleClose:()=>n({id:""}),footerActive:!1,children:d.jsx(O,{rolls:r,defaultValues:a,refetch:e,id:t})})},B=e=>{const t=Math.floor(e/3600),n=Math.floor(e%3600/60);return t>0?`${t} soat${t>1?"s":""} ${n} minut`:`${n} minut`},P=(e,t)=>{switch(t){case"time":return e;case"secunds":return B(e);default:return e}},U=()=>{const{filters:e}=$({}),{q:t,page:n}=e,{data:r,isLoading:a,refetch:i}=j(["GET_ADMINS",t,n],()=>b.getList({q:t??"",page:n||1})),s=p.useMemo(()=>({list:(r==null?void 0:r.data)??[],...r}),[r]);return{isLoading:a,refetch:i,bodyColumns:s,q:t}},I=[{label:"Admin",link:"/admins/admin"},{label:"Adminlar"}],W=()=>{const{navigateQuery:e}=g(),t=r=>{e({q:r})};return{headColumns:p.useMemo(()=>[{title:"Ism familiya",id:"name"},{title:"Login",id:"email"},{title:"Tel.raqam",id:"phone"},{title:"Rollar",id:"roles",render:r=>d.jsx("div",{children:r==null?void 0:r.map((a,i,s)=>d.jsxs("p",{children:[a.name,s.length>1&&i!==s.length-1?",":""]},i))})},{title:"Qo'shilgan sana",id:"created_at",render:r=>d.jsx(d.Fragment,{children:P(r)})},{title:"Status",id:"status",render:r=>d.jsx("div",{className:r==="inactive"?"text-[var(--error)]":r==="active"?"text-[var(--green)]":"",children:r==="inactive"?"Noaktiv":r==="active"?"Aktiv":""})},{title:"",id:"actions",actions:["edit","delete","view"]}],[]),handleSearch:t}},ae=()=>{const{navigateQuery:e}=g(),{getQueries:t}=g(),n=t(),{headColumns:r}=W(),[a,i]=p.useState({}),{bodyColumns:s,isLoading:u,refetch:l}=U(),{collectFilter:x,storeFilters:A}=T({store:!0,filterParams:a}),o=m=>{i(m),A(m)},f=m=>{x({type:"q",val:m}),o({...a,q:m,page:1})},y=p.useCallback((m,F)=>{if(F==="view"&&e({id:m.id}),F==="edit"&&e({id:m.id}),F==="delete"){if(m.email==="superrt@akataxi.uz")return;b.deleteAdmin(m.id).then(()=>{l()})}},[]);return d.jsxs(d.Fragment,{children:[d.jsx(E,{extra:d.jsx(N,{items:I,progmatic:!0,handleSearch:f,defaultValue:a==null?void 0:a.q}),children:d.jsx("div",{className:"ml-5",children:d.jsx(w,{text:"new_admin",onClick:()=>e({id:"create"})})})}),d.jsxs("div",{className:"container",children:[d.jsx(k,{headColumns:r,bodyColumns:s.list,meta:s==null?void 0:s.meta,isResizeble:!0,isLoading:u,handleActions:y,filterParams:a,handleFilterParams:o}),(n==null?void 0:n.id)&&d.jsx(z,{refetch:l,id:n.id})]})]})};export{ae as default};

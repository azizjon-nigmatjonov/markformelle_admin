import{u as f,r as p,a as h,b as S,c as v,w as q,d as A,e as m,f as M,g as C,o as _,j as d,C as L,H as T,h as k,A as Q}from"./index-DRACHr32.js";import{C as R}from"./index-Cp2NbtL3.js";import{a as g}from"./index-BVjPFrZ3.js";import{r as E}from"./index-DDFLSLbX.js";import{F as N}from"./formatTime-CQD8gUvM.js";import{g as V,F as $}from"./index-4kaVakTx.js";import"./index-mGIeUDps.js";import"./PopOver-X96IiLWI.js";const w=({adminId:t})=>{const{data:r}=f(["GET_ROLLS_LIST"],()=>E.getList()),{data:n}=f(["GET_ROLL_DATA",t],()=>g.getAdmin(t),{enabled:!!(t&&t!=="create")}),e=p.useMemo(()=>r?((r==null?void 0:r.data)??[]).map(a=>({...a,label:a.name,value:a.id})):[],[r]),s=p.useMemo(()=>{var a;const i=n==null?void 0:n.data;return i!=null&&i.id&&(i.roles=(a=i.roles)==null?void 0:a.map(u=>u.id)),i},[n]);return{rolls:e,defaultValues:s}},D=({refetch:t,reset:r})=>{const{navigateQuery:n}=h(),e=S(),s=o=>{e(q.setAlertData({title:o,translation:"common"})),n({id:""}),t(),r()},{mutate:i,isLoading:a}=v({mutationFn:o=>g.createAdmin(o).then(()=>{s("Admin yaratildi!")})}),{mutate:u,isLoading:l}=v({mutationFn:o=>g.updateAdmin(o,o.id).then(()=>{s("Ma'lumot yangilandi!")})});return{submitForm:o=>{o.phone=o.phone.substring(1).replace(/\s+/g,""),i(o)},updateForm:(o,b)=>{o.phone=o.phone.substring(1).replace(/\s+/g,"");const y=o;y.id=b,u(y)},isLoading:l||a}},G=()=>A().shape({name:m().required("Majbiriy maydon"),email:m().required("Majburiy maydon").email("enter_valid_email"),roles:M().of(m()).required("Majburiy maydon").test("is-roles-empty","Majburiy maydon",t=>t&&t.length>0),phone:m().matches(/^(\+998)\s(9[0-9])\s([0-9]{3})\s([0-9]{2})\s([0-9]{2})$/,"enter_valid_phone_number").required("enter_phone_number"),password:m().required("Majbiriy maydon")}),H=()=>A().shape({name:m().required("Majburiy maydon"),email:m().required("Majburiy maydon").email("Tog'ri email kiriting!"),phone:m().required("enter_phone_number"),roles:M().of(m()).required("Majburiy maydon").test("is-roles-empty","Majburiy maydon",t=>t&&t.length>0)}),O=({refetch:t,id:r})=>{const n=r==="create"?G():H(),{handleSubmit:e,reset:s}=C({mode:"onSubmit",resolver:_(n)}),{submitForm:i,updateForm:a}=D({reset:s,refetch:t}),u=l=>{r==="create"?i(l):a(l,r)};return d.jsx("form",{onSubmit:e(u)})},z=({refetch:t,id:r})=>{const{navigateQuery:n}=h(),{rolls:e,defaultValues:s}=w({adminId:r});return d.jsx(L,{title:r?"edit":"add",open:!0,handleClose:()=>n({id:""}),footerActive:!1,children:d.jsx(O,{rolls:e,defaultValues:s,refetch:t,id:r})})},B=()=>{const{filters:t}=V({}),{q:r,page:n}=t,{data:e,isLoading:s,refetch:i}=f(["GET_ADMINS",r,n],()=>g.getList({q:r??"",page:n||1})),a=p.useMemo(()=>({list:(e==null?void 0:e.data)??[],...e}),[e]);return{isLoading:s,refetch:i,bodyColumns:a,q:r}},P=[{label:"admin",link:"/admins/admin"},{label:"admins"}],U=()=>{const{navigateQuery:t}=h(),r=e=>{t({q:e})};return{headColumns:p.useMemo(()=>[{title:"Ism familiya",id:"name"},{title:"Login",id:"email"},{title:"Tel.raqam",id:"phone"},{title:"Rollar",id:"roles",render:e=>d.jsx("div",{children:e==null?void 0:e.map((s,i,a)=>d.jsxs("p",{children:[s.name,a.length>1&&i!==a.length-1?",":""]},i))})},{title:"Qo'shilgan sana",id:"created_at",render:e=>d.jsx(d.Fragment,{children:N(e)})},{title:"Status",id:"status",render:e=>d.jsx("div",{className:e==="inactive"?"text-[var(--error)]":e==="active"?"text-[var(--green)]":"",children:e==="inactive"?"Noaktiv":e==="active"?"Aktiv":""})},{title:"",id:"actions",actions:["edit","delete","view"]}],[]),handleSearch:r}},te=()=>{const{navigateQuery:t}=h(),{getQueries:r}=h(),n=r(),{headColumns:e}=U(),[s,i]=p.useState({}),{bodyColumns:a,isLoading:u,refetch:l}=B(),{collectFilter:j,storeFilters:x}=$({store:!0,filterParams:s}),o=c=>{i(c),x(c)},b=c=>{j({type:"q",val:c}),o({...s,q:c,page:1})},y=p.useCallback((c,F)=>{if(F==="view"&&t({id:c.id}),F==="edit"&&t({id:c.id}),F==="delete"){if(c.email==="superrt@akataxi.uz")return;g.deleteAdmin(c.id).then(()=>{l()})}},[]);return d.jsxs(d.Fragment,{children:[d.jsx(T,{extra:d.jsx(k,{items:P,progmatic:!0,handleSearch:b,defaultValue:s==null?void 0:s.q}),children:d.jsx("div",{className:"ml-5",children:d.jsx(Q,{text:"add",onClick:()=>t({id:"create"})})})}),d.jsxs("div",{className:"container",children:[d.jsx(R,{headColumns:e,bodyColumns:a.list,meta:a==null?void 0:a.meta,isResizeble:!0,isLoading:u,handleActions:y,filterParams:s,handleFilterParams:o}),(n==null?void 0:n.id)&&d.jsx(z,{refetch:l,id:n.id})]})]})};export{te as default};

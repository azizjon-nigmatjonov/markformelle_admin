import{j as e,a as j,u as y,b as I,a2 as P,d as C,e as T,f as N,g as _,a3 as O,a4 as M,h as U,o as w}from"./index-CTFI2LGG.js";import{H as q,C as G}from"./index-BbpQxzbw.js";import{r as $,L as A}from"./ListSkeleton-BYIIJlUQ.js";import{r as L,C as B}from"./index-DYxRhrm6.js";const F=({text:t,children:s})=>e.jsxs("div",{className:"flex items-start gap-8 py-6",children:[e.jsx("p",{className:"text-sm text-[var(--gray70)] font-medium w-[280px]",children:t}),e.jsx("div",{className:"w-full",children:s})]}),H=({id:t})=>({breadCrumbsItems:j.useMemo(()=>[{label:"Admin",link:"/admins/admin"},{label:"Rollar",link:"/admins/rolls"},{label:t!=="create"?"Rolni tahrirlash":"Yangi rol yaratish"}],[t])}),V=({id:t})=>{const{data:s,isLoading:n}=y(["GET_ROLL_FOR_UPDATE",t],()=>L.getElement(t),{enabled:!!t}),{data:r,isLoading:a,refetch:o}=y(["GET_ROUTE_LIST_FOR_ROLLS"],()=>$.getList()),d=j.useMemo(()=>{var p;return((p=r==null?void 0:r.data)==null?void 0:p.map(i=>{var u;return{...i,permissions:(u=i.permissions)==null?void 0:u.map(h=>({...h,label:h.name.substring(h.name.indexOf("#")+1),value:h.id}))}}))??[]},[r]);return{isLoading:a,refetch:o,newRouteList:d,rollData:(s==null?void 0:s.data)||{},rollLoading:n}},Y=({reset:t=()=>{}})=>{const{navigateTo:s}=I(),{refetchUserInfo:n}=P(),{mutate:r,isLoading:a}=C({mutationFn:i=>L.createElement(i).then(()=>{t(),n(),s("/admins/rolls")})}),{mutate:o,isLoading:d}=C({mutationFn:i=>L.updateElement(i,i.id).then(()=>{t(),n(),s("/admins/rolls")})});return{createRoll:i=>{r(i)},updateRoll:(i,u)=>{i.id=u,o(i)},isLoading:a||d}},z=()=>T().shape({name:N().required("Majbiriy maydon"),permissions:_().of(N()).required("Majbiriy maydon").test("is-roles-empty","Permission kiritilmagan",t=>t&&t.length>0)}),Q=({route:t,errors:s,permissions:n=[],handleCheck:r})=>e.jsxs(F,{text:t.name,children:[t.permissions.length?e.jsx(e.Fragment,{children:e.jsx("button",{onClick:()=>r(t.permissions,"all"),className:"text-[var(--main)] underline mb-5 font-medium",children:"Barchasini belgilash"})}):"",e.jsx("div",{className:"grid grid-cols-3 gap-5",children:t.permissions.map(a=>{var o;return e.jsxs("div",{className:"relative",children:[e.jsx(B,{checked:n==null?void 0:n.includes(a.value),handleCheck:d=>r(d),element:{label:a.label,value:a.id}}),(o=s==null?void 0:s.permissions)!=null&&o.message&&!(n!=null&&n.length)?e.jsx("p",{className:"text-[var(--error)] text-sm absolute bottom-[-18px] left-2",children:s.permissions.message}):""]},a.id)})})]},t.path),D=({isLoading:t,newRouteList:s,errors:n={},permissions:r=[],handleCheck:a})=>t?e.jsx("div",{children:e.jsx(A,{direction:"row",count:7,height:102})}):s!=null&&s.length?e.jsx(e.Fragment,{children:s.map(o=>e.jsx(Q,{handleCheck:a,permissions:r,route:o,errors:n}))}):e.jsx("div",{className:"w-full flex justify-center mt-10",children:e.jsx("img",{className:"w-[200px]",src:"/public/images/no-data.png",alt:"no data"})}),J=({id:t,handleSubmit:s,onSubmit:n,isLoading:r=!1})=>e.jsx("form",{onSubmit:s(n),children:e.jsx("div",{className:"fixed top-[90px] right-20px",children:r?e.jsx("div",{className:"custom-btn",children:e.jsx(O,{size:24})}):e.jsx("button",{type:"submit",className:"custom-btn",children:t!==":create"?"Tahrirlash":"Rol qo'shish"})})}),ee=()=>{const t=z(),{id:s}=M(),{newRouteList:n,isLoading:r,rollData:a}=V({id:s}),{control:o,handleSubmit:d,setValue:f,formState:{errors:p}}=U({mode:"onSubmit",resolver:w(t)}),{createRoll:i,updateRoll:u,isLoading:h}=Y({}),{breadCrumbsItems:S}=H({id:s}),[x,R]=j.useState([]),k=l=>{const v=l.permissions.map(c=>parseInt(c.trim(),10));l.permissions=v,s!==":create"?u(l,s):i(l)},E=(l,v)=>{let c=x;if(v==="all"){const m=l==null?void 0:l.map(g=>g.id),b=m.find(g=>{x.includes(g)});console.log("111",m),b?c=x.filter(g=>{if(!m.includes(g))return g}):c=[...c,...m]}else{const m=l.value;x.find(b=>b===m)?c=x.filter(b=>b!==m):c=[...c,m]}f("permissions",c),R(c)};return j.useEffect(()=>{var l;(l=a==null?void 0:a.permissions)!=null&&l.length&&(R(a.permissions),f("permissions",a.permissions))},[a]),e.jsxs(e.Fragment,{children:[e.jsx(q,{sticky:!0,children:e.jsx(G,{items:S,progmatic:!0,type:"link"})}),e.jsxs("div",{className:"container divide-y-[1px] divide-[var(--gray20)] w-[80%] my-5",children:[e.jsx(F,{text:"Yangi rol nomi",children:e.jsx(J,{id:s,handleSubmit:d,onSubmit:k,control:o,setValue:f,rollData:a,isLoading:h})}),e.jsx(D,{newRouteList:n,isLoading:r,handleCheck:E,permissions:x,errors:p})]})]})};export{ee as default};

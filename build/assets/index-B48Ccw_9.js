import{r as x,u as S,a as j,d as h,Y as C,e as g,g as E,f,h as N,o as y,j as e,a3 as P,a6 as v,b as L,N as q,O as k,K as F,a7 as I,a8 as M}from"./index-CTFI2LGG.js";import{A as T}from"./AddButton-BzXG_pbh.js";import{H as $,C as _}from"./index-BbpQxzbw.js";import{r as b,L as D}from"./ListSkeleton-BYIIJlUQ.js";import{P as O}from"./PopOver-CxqJjWXh.js";import{C as Q}from"./index-B9pHVk68.js";import"./useModal-CEVRpokf.js";const w={deleteElement:s=>x.delete(`/permissions/${s}`),getList:()=>x.get("/permissions"),createElement:s=>x.post("/permissions",s)},z=[{label:"Sahifani ko'rsatish",value:"index"},{label:"Ichki sahifani ko'rsatish",value:"view"},{label:"Qo'shish",value:"add"},{label:"Tahrirlash",value:"edit"},{label:"O'chirish",value:"delete"}],R=({handleClose:s,reset:t})=>{const{mutate:i,isLoading:a}=h({mutationFn:r=>b.createElement(r).then(()=>{s(),t()})}),{mutate:n,isLoading:l}=h({mutationFn:r=>w.createElement(r).then(()=>{s(),t()})});return{createRoute:r=>{const o={};o.path=r.name,o.name=r.title,i(o)},isLoading:a||l,createPermission:(r,o,c)=>{const u={};u.name=c+"#"+r,u.permission_route_id=o,n(u)}}},A=({handleClose:s})=>{const{mutate:t,isLoading:i}=h({mutationFn:m=>w.deleteElement(m).then(()=>{s()})}),{mutate:a,isLoading:n}=h({mutationFn:m=>b.deleteElement(m).then(()=>{s()})});return{deletePermission:m=>{t(m)},deleteRoute:m=>{a(m)},isLoading:i||n}},Y=s=>{const t=[];for(const i in s)s[i].forEach(a=>{a.single_page||t.push(a)});return t},B=()=>{const{data:s,isLoading:t,refetch:i}=S(["GET_ROUTE_LIST"],()=>b.getList()),a=j.useMemo(()=>{var l;return((l=s==null?void 0:s.data)==null?void 0:l.map(d=>{var r;const m=(r=d.permissions)==null?void 0:r.map(o=>({...o,label:o.name.substring(o.name.indexOf("#")+1),value:o.id}));return{...d,permissions:m??[]}}))??[]},[s]);return{isLoading:t,refetch:i,newRouteList:a}},G=({list:s,path:t})=>{const i=C(n=>n.website.new_routes);return{permissionOptions:j.useMemo(()=>{var r,o;const n=[];return[...((o=(r=Y(i).find(c=>c.path===t))==null?void 0:r.permissions)==null?void 0:o.map(c=>({label:c,value:c})))??[],...z].forEach(c=>{s.find(p=>p.label===c.value)||n.push(c)}),n},[s])??[]}},H=()=>g().shape({permissions:E().of(f()).required("Majbiriy maydon").test("is-permissions-empty","Permission kiritilmagan",s=>s&&s.length>0)}),V=({id:s,path:t="",list:i=[],handleClose:a})=>{const{permissionOptions:n}=G({list:i,path:t}),l=H(),{handleSubmit:d,reset:m}=N({mode:"onSubmit",resolver:y(l)}),{createPermission:r,isLoading:o}=R({handleClose:a,reset:m});if(o)return e.jsx("div",{children:e.jsxs("button",{className:"custom-btn",children:[e.jsx(P,{size:24}),e.jsx(v,{})]})});const c=u=>{u.permissions.forEach(p=>{r(p,s,t)})};return n!=null&&n.length?e.jsx("form",{onSubmit:d(c),className:"flex space-x-5",children:e.jsx("div",{className:"w-[70px]",children:e.jsx("button",{type:"submit",className:"custom-btn",children:e.jsx(v,{})})})}):""},J=({route:s,handleClose:t=()=>{},deleteRoute:i=()=>{},deletePermission:a=()=>{}})=>{var o;const{navigateTo:n}=L(),[l,d]=j.useState(!1),{t:m}=q(),r=(c,u)=>{c==="delete"&&i(u),d(!1)};return e.jsxs("div",{className:"flex space-x-10 py-20px border-t border-[var(--gray20)]",children:[e.jsxs("div",{className:"w-[360px] relative",children:[e.jsxs("div",{className:"w-[360px] flex items-center justify-between",children:[e.jsx("p",{className:"",children:s.name}),e.jsxs("div",{className:"flex items-center space-x-5",children:[e.jsx("button",{onClick:()=>n(`/${s.path}?fromRoutes=/admins/routes`),children:e.jsx(k,{fill:"var(--primary)"})}),e.jsx("button",{onClick:()=>d(!0),children:e.jsx(F,{})})]})]}),l&&e.jsx(O,{title:`${s.name}`,text:"Routeni ochirmoqchimsiz!",classes:"top-[30px] left-auto right-0",closePopover:c=>{r(c,s.id)}})]}),e.jsx("div",{className:"w-[1px] h-[30px] bg-[var(--gray30)] common-shadow"}),e.jsx("div",{className:"w-full",children:e.jsxs("div",{className:"flex gap-5 flex-wrap",children:[(o=s.permissions)==null?void 0:o.map(c=>e.jsxs("div",{className:"border border-[var(--gray20)] h-[40px] px-16px whitespace-nopwrap rounded-[8px] common-shadow min-w-[120px] flex items-center justify-between space-x-5",children:[e.jsx("span",{children:m(c.label)}),e.jsx("button",{onClick:()=>a(c.id),className:"border border-[var(--gray30)] rounded-full w-[20px] h-[20px] flex items-center justify-center cursor-pointer",children:e.jsx(I,{})})]})),e.jsx(V,{list:s.permissions,handleClose:t,id:s.id,route:s,path:s.path})]})})]})},K=({newRouteList:s,isLoading:t=!0,handleClose:i})=>{if(t)return e.jsx("div",{className:"mt-10",children:e.jsx(D,{direction:"row",count:7,height:102})});if(!(s!=null&&s.length))return e.jsx("div",{className:"w-full flex justify-center mt-10",children:e.jsx("img",{className:"w-[200px]",src:"/public/images/no-data.png",alt:"no data"})});const{deletePermission:a,deleteRoute:n}=A({handleClose:i});return e.jsx("div",{className:"mt-10",children:s.map((l,d)=>e.jsx(J,{handleClose:i,deleteRoute:n,deletePermission:a,route:l},d))})},U=()=>g().shape({name:f().required("Majbiriy maydon"),title:f().required("Majbiriy maydon")}),W=({handleClose:s=()=>{}})=>{const t=U(),{handleSubmit:i,reset:a}=N({mode:"onSubmit",resolver:y(t)}),{createRoute:n,isLoading:l}=R({handleClose:s,reset:a}),d=m=>n(m);return e.jsx(Q,{title:"Yangi route qo'shish",open:!0,handleClose:()=>s(),footerActive:!1,children:e.jsx("form",{onSubmit:i(d),children:e.jsx("div",{className:"mt-5",children:l?e.jsxs("div",{className:"custom-btn disabled form",children:[e.jsx(P,{size:30}),"Jo'natilmoqda"]}):e.jsx("button",{type:"submit",className:"custom-btn form",children:"Tasdiqlash"})})})})},X=[{label:"Routes",link:"/admins/routes"},{label:"Routes sahifasi"}],re=()=>{const{navigateQuery:s}=L(),{modal:t}=M(),{newRouteList:i,refetch:a,isLoading:n}=B(),l=()=>{s({modal:"",active:""}),a()};return e.jsxs(e.Fragment,{children:[e.jsx($,{extra:e.jsx(_,{items:X,progmatic:!0}),children:e.jsx("div",{className:"ml-5",children:e.jsx(T,{onClick:()=>s({modal:"open"}),iconLeft:!0,text:"Route qo'shish"})})}),e.jsxs("div",{className:"container",children:[e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-[#101828] text-lg font-semibold",children:"Yangi sahifa va permission qo'shish"}),e.jsx("p",{className:"text-[#475467] text-sm font-normal",children:"Permission boshqaruvi uchun yangi sahifa va permission qo'shish joyi"})]})}),e.jsx(K,{isLoading:n,handleClose:l,newRouteList:i})]}),t&&e.jsx(W,{handleClose:l,newRouteList:i})]})};export{X as breadCrumbs,re as default};
